OASISFormat: 0.3
Name: batyr
Version: 0.2
Synopsis: A jabber logger and web interface
Authors: Petter A. Urkedal
License: GPL-3
Plugins: DevFiles (0.3)

FilesAB: META.ab, lib/batyr_version.ml.ab

BuildType: custom (0.3)
BuildDepends: calendar, config-file, eliom, erm_xmpp, lwt, lwt.ssl,
  postgresql, prime, prime.testing
XCustomBuild: ocamlbuild-with-findlib lib.otarget client.otarget server.otarget
XCustomBuildClean: ocamlbuild-with-findlib -clean

InstallType: custom (0.3)
XCustomInstall:
  set -e
  ocamlfind install batyr META \
    lib/*.mli _build/lib/*.cmi \
    _build/lib/*.cma _build/lib/*.cmxa _build/lib/*.a \
    _build/web/server/*.cmi _build/web/server/*.cma
  install -d $datadir/$pkg_name/static/css
  install static/css/*.css $datadir/$pkg_name/static/css/
  install _build/static/*.js $datadir/$pkg_name/static/
  echo "Installed static web content under $datadir/$pkg_name/static"
  install _build/$pkg_name.conf $datadir/$pkg_name/$pkg_name.conf.sample
  echo "Installed sample config $datadir/$pkg_name/$pkg_name.conf.sample"
  install -d $datadir/$pkg_name/schemas
  install schemas/*.sql $datadir/$pkg_name/schemas/
  for dir in schemas/updates/*; do
    install -d $datadir/$pkg_name/\$dir
    install \$dir/*.sql $datadir/$pkg_name/\$dir/
  done
  echo "Installed DB schemas under $datadir/$pkg_name/schemas"
XCustomUninstall:
  ocamlfind remove $pkg_name
  rm -rf $datadir/$pkg_name
  echo "Removed $datadir/$pkg_name"
